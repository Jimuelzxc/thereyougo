<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>There You Go: AI Video Generator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        h1 {
            font-size: 4em;
            letter-spacing: -2px;
            margin: 0;
            padding: 0;
        }

        input {
            padding: 10px 10px;
            padding-right: 30px;
        }

        button {
            padding: 10px;
        }

        .container {
            display: flex;
            flex-direction: column;
            width: 500px;
            padding: 20px;
            gap: 5px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
            margin-bottom: 10px;
        }

        p {
            transform: translateY(-20px);
        }

        #autofill-title-btn {
            position: absolute;
            right: 0;
            bottom: 0;

        }

        #autofill-script-btn,
        #autofill-btn {

            position: absolute;
            right: 0;
            bottom: 0;
            margin: 10px;

        }

        textarea {
            padding: 10px;
        }
        select{
            padding: 10px;
        }
        .or{
            text-align: center;
            transform: translateY(-20px);
            opacity: 40%;
        }
        #generate-btn{
            padding: 20px 0;
        }
        video{
            width: 100%;
        }
        #status{
            padding: 20px 0;

        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>There You Go</h1>
            <p style="opacity: 50%;">automated video creation tool for you.</p>
        </header>

        <div class="input-group" style="margin-bottom: 50px;">
            <label for="topic">Topic</label>
            <input type="text" id="topic" placeholder="Enter a topic">
            <button id="autofill-all-btn" class="autofill-btn">Autofill All</button>
        </div>

        <div class="or">
            or
        </div>

        <div class="input-group">
            <label for="title">Video Title</label>
            <input type="text" id="title" placeholder="Enter the title for your video">
            <button id="autofill-title-btn" class="autofill-btn">AI Autofill</button>
        </div>

        <div class="input-group">
            <label for="script">Script</label>
            <textarea id="script" rows="8" placeholder="Enter the full script for the audio narration."></textarea>
            <button id="autofill-script-btn" class="autofill-btn">AI Autofill</button>
        </div>

        <div class="input-group">
            <label for="prompts">Image Prompts (JSON Array)</label>
            <textarea id="prompts" rows="8"
                placeholder='[&#10;  "A robot writing a script.",&#10;  "A computer screen with code.",&#10;  "A final rendered video."&#10;]'></textarea>
            <button id="autofill-btn" class="autofill-btn">AI Autofill</button>
        </div>

        <div class="input-group">
            <label for="tts-model">Text-to-Speech Model</label>
            <select id="tts-model">
                <option value="elevenlabs">ElevenLabs (Default)</option>
                <option value="Qwen/Qwen-TTS-Demo">Qwen/Qwen-TTS-Demo</option>
                <option value="NihalGazi/Text-To-Speech-Unlimited">NihalGazi/Text-To-Speech-Unlimited</option>
            </select>
        </div>

        <button id="generate-btn">
            <span class="spinner"></span>
            <span class="btn-text">Generate Video</span>
        </button>

        <div id="status"></div>
        <div id="video-container" style="display:none;">
            <h2>Generated Video:</h2>
            <video id="video-player" controls></video>
        </div>
    </div>

    <script>
        const topicInput = document.getElementById('topic');
        const titleInput = document.getElementById('title');
        const scriptInput = document.getElementById('script');
        const promptsInput = document.getElementById('prompts');

        const generateBtn = document.getElementById('generate-btn');
        const generateBtnText = generateBtn.querySelector('.btn-text');
        const spinner = generateBtn.querySelector('.spinner');
        const statusDiv = document.getElementById('status');
        const videoContainer = document.getElementById('video-container');
        const videoPlayer = document.getElementById('video-player');

        const autofillPromptsBtn = document.getElementById('autofill-btn');
        const autofillScriptBtn = document.getElementById('autofill-script-btn');
        const autofillTitleBtn = document.getElementById('autofill-title-btn');
        const autofillAllBtn = document.getElementById('autofill-all-btn');

        const updateButtonStates = () => {
            const topicEmpty = topicInput.value.trim() === '';
            const titleEmpty = titleInput.value.trim() === '';
            const scriptEmpty = scriptInput.value.trim() === '';
            const promptsEmpty = promptsInput.value.trim() === '';

            autofillAllBtn.disabled = topicEmpty;
            autofillTitleBtn.disabled = topicEmpty;
            autofillScriptBtn.disabled = titleEmpty;
            autofillPromptsBtn.disabled = scriptEmpty;
            generateBtn.disabled = titleEmpty || scriptEmpty || promptsEmpty;
        };

        topicInput.addEventListener('input', updateButtonStates);
        titleInput.addEventListener('input', updateButtonStates);
        scriptInput.addEventListener('input', updateButtonStates);
        promptsInput.addEventListener('input', updateButtonStates);

        document.addEventListener('DOMContentLoaded', updateButtonStates);

        const setLoading = (button, isLoading) => {
            const text = button.querySelector('.btn-text');
            const spinner = button.querySelector('.spinner');
            if (isLoading) {
                text.style.display = 'none';
                spinner.style.display = 'block';
                button.disabled = true;
            } else {
                text.style.display = 'inline';
                spinner.style.display = 'none';
                button.disabled = false;
            }
        };

        async function autofillTitle() {
            statusDiv.textContent = 'Generating title with AI...';
            try {
                const response = await fetch('/generate-title', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic: topicInput.value }),
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                if (data.error) throw new Error(data.error);

                titleInput.value = data.title;
                statusDiv.textContent = 'Title generated successfully!';
                updateButtonStates();
                return true;
            } catch (error) {
                statusDiv.textContent = `An error occurred while generating title: ${error.message}`;
                console.error('Error generating title:', error);
                return false;
            }
        }

        async function autofillScript() {
            statusDiv.textContent = 'Generating script with AI...';
            try {
                const response = await fetch('/generate-script', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: titleInput.value }),
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                if (data.error) throw new Error(data.error);

                scriptInput.value = data.script;
                statusDiv.textContent = 'Script generated successfully!';
                updateButtonStates();
                return true;
            } catch (error) {
                statusDiv.textContent = `An error occurred while generating script: ${error.message}`;
                console.error('Error generating script:', error);
                return false;
            }
        }

        async function autofillPrompts() {
            statusDiv.textContent = 'Generating image prompts with AI...';
            try {
                const response = await fetch('/generate-image-prompts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ script: scriptInput.value }),
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                if (data.error) throw new Error(data.error);

                promptsInput.value = JSON.stringify(data.prompts, null, 2);
                statusDiv.textContent = 'Image prompts generated successfully!';
                updateButtonStates();
                return true;
            } catch (error) {
                statusDiv.textContent = `An error occurred while generating prompts: ${error.message}`;
                console.error('Error generating prompts:', error);
                return false;
            }
        }

        autofillTitleBtn.addEventListener('click', autofillTitle);
        autofillScriptBtn.addEventListener('click', autofillScript);
        autofillPromptsBtn.addEventListener('click', autofillPrompts);

        autofillAllBtn.addEventListener('click', async () => {
            const titleSuccess = await autofillTitle();
            if (titleSuccess) {
                const scriptSuccess = await autofillScript();
                if (scriptSuccess) {
                    await autofillPrompts();
                }
            }
        });

        generateBtn.addEventListener('click', async () => {
            const title = document.getElementById('title').value;
            const script = document.getElementById('script').value;
            const promptsText = document.getElementById('prompts').value;
            const ttsModel = document.getElementById('tts-model').value;

            let prompts;
            try {
                prompts = JSON.parse(promptsText);
            } catch (e) {
                alert('Invalid JSON format for image prompts.');
                return;
            }

            statusDiv.textContent = 'Generating video... This may take a few minutes.';
            videoContainer.style.display = 'none';
            setLoading(generateBtn, true);

            try {
                const response = await fetch('/generate-full-video', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: title,
                        script: script,
                        generate_image_prompts: prompts,
                        tts_model: ttsModel
                    }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const videoBlob = await response.blob();
                const videoUrl = URL.createObjectURL(videoBlob);

                videoPlayer.src = videoUrl;
                videoContainer.style.display = 'block';
                statusDiv.textContent = 'Video generated successfully!';

            } catch (error) {
                statusDiv.textContent = `An error occurred: ${error.message}`;
                console.error('Error generating video:', error);
            } finally {
                setLoading(generateBtn, false);
            }
        });
    </script>
</body>

</html>